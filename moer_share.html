<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPU vs GPU vs NPU 核心架构解析</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #151515;
            --panel-bg: #222;
            --text-main: #ffffff;
            --accent-amber: #ffc033;
            --accent-cyan: #33ffff;
            --accent-red: #ff6666;
            --accent-green: #66ff66;
            --grid-line: #333;
            --scanline: rgba(0, 0, 0, 0.2);
        }

        @keyframes scanline {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 0 100%;
            }
        }

        @keyframes flicker {
            0% {
                opacity: 0.97;
            }

            5% {
                opacity: 0.95;
            }

            10% {
                opacity: 0.9;
            }

            15% {
                opacity: 0.95;
            }

            20% {
                opacity: 0.99;
            }

            50% {
                opacity: 0.95;
            }

            55% {
                opacity: 0.9;
            }

            60% {
                opacity: 0.99;
            }

            100% {
                opacity: 0.97;
            }
        }

        @keyframes grid-scroll {
            0% {
                transform: translate3d(0, 0, 0);
            }

            100% {
                transform: translate3d(30px, 30px, 0);
            }
        }

        body {
            font-family: 'VT323', 'Courier New', 'Microsoft YaHei', monospace;
            font-size: 1.2rem;
            line-height: 1.6;
            color: var(--text-main);
            text-shadow: 0 0 6px rgba(0, 255, 255, 0.6);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            overflow: hidden;
            /* Full screen PPT mode */
            cursor: none;
            height: 100vh;
            width: 100vw;
        }

        /* Music Toggle Button - Cassette Futurism Style */
        .music-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;

            /* Retro Plastic Body */
            background: #1a1a1a;
            border: 1px solid #333;

            /* Bevel & Depth */
            box-shadow:
                inset 1px 1px 0px rgba(255, 255, 255, 0.1),
                inset -1px -1px 0px rgba(0, 0, 0, 0.5),
                4px 4px 0px rgba(0, 0, 0, 0.5);

            color: #555;
            /* Off state text */
            padding: 6px 12px;
            /* Smaller size */

            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: bold;

            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);

            /* Decorative angled corners */
            clip-path: polygon(8px 0, 100% 0,
                    100% calc(100% - 8px),
                    calc(100% - 8px) 100%,
                    0 100%, 0 8px);
        }

        /* The "LED" indicator strip */
        .music-toggle::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #330000;
            /* Dark Red */
            border-radius: 50%;
            box-shadow: inset 1px 1px 2px rgba(0, 0, 0, 0.8);
            transition: all 0.3s;
            border: 1px solid #000;
        }

        .music-toggle:hover {
            background: #222;
            color: #777;
            transform: translate(-1px, -1px);
            box-shadow:
                inset 1px 1px 0px rgba(255, 255, 255, 0.1),
                inset -1px -1px 0px rgba(0, 0, 0, 0.5),
                5px 5px 0px rgba(0, 0, 0, 0.5);
        }

        .music-toggle:active {
            transform: translate(2px, 2px);
            box-shadow:
                inset 2px 2px 5px rgba(0, 0, 0, 0.8),
                0px 0px 0px rgba(0, 0, 0, 0);
        }

        /* Playing State */
        .music-toggle.playing {
            color: #ffaa00;
            /* Retro Amber */
            text-shadow: 0 0 8px rgba(255, 170, 0, 0.6);
            background: #1a1a1a;
            border-color: #553300;
        }

        .music-toggle.playing::before {
            background: #ff3300;
            /* Bright Red LED */
            box-shadow: 0 0 8px #ff3300, inset 1px 1px 2px rgba(255, 255, 255, 0.4);
            border-color: #880000;
        }

        .music-toggle.playing:hover {
            color: #ffcc00;
            text-shadow: 0 0 12px rgba(255, 170, 0, 0.8);
        }

        .universe-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, #2b3745 0%, #15151a 100%);
            z-index: -2;
            overflow: hidden;
        }

        .stars {
            width: 1px;
            height: 1px;
            background: transparent;
            box-shadow: 1744px 122px #FFF, 134px 1321px #FFF, 92px 859px #FFF;
            animation: animStar 50s linear infinite;
        }

        .stars2 {
            width: 2px;
            height: 2px;
            background: transparent;
            box-shadow: 1744px 122px #FFF, 134px 1321px #FFF, 92px 859px #FFF;
            animation: animStar 100s linear infinite;
        }

        .stars3 {
            width: 3px;
            height: 3px;
            background: transparent;
            box-shadow: 1744px 122px #FFF, 134px 1321px #FFF, 92px 859px #FFF;
            animation: animStar 150s linear infinite;
        }

        @keyframes animStar {
            from {
                transform: translateY(0px);
            }

            to {
                transform: translateY(-2000px);
            }
        }

        /* Navigation Menu */
        .nav-menu-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2000;
            /* Higher than everything */
            font-family: 'Share Tech Mono', monospace;

            /* Hidden state by default */
            opacity: 0;
            pointer-events: none;
            /* 关键：隐藏时不阻挡点击 */
            transform: translate(-30px, -30px) scale(0.9);
            /* 收缩在左上角 */
            transform-origin: top left;

            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            /* 顺滑的展开动画 */
        }

        /* Invisible hover area to reveal menu */
        .nav-trigger-area {
            position: fixed;
            top: 0;
            left: 0;
            width: 60px;
            /* 缩小触发区域，仅限左上角 */
            height: 60px;
            z-index: 2001;
            cursor: crosshair;
            /* 提示这里有东西 */
        }

        /* Show menu when hovering trigger area OR the menu itself */
        .nav-trigger-area:hover+.nav-menu-container,
        .nav-menu-container:hover {
            opacity: 1;
            pointer-events: auto;
            transform: translate(0, 0) scale(1);
            /* 展开 */
        }

        .nav-toggle {
            background: linear-gradient(180deg, #2a2a2a, #1a1a1a);
            border: 2px solid var(--accent-cyan);
            color: var(--accent-cyan);
            padding: 8px 15px;
            cursor: pointer;
            font-size: 1rem;
            text-transform: uppercase;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 8px;
            border-radius: 4px;
            /* 3D Button Effect with Glow */
            box-shadow:
                0 0 10px rgba(0, 255, 255, 0.2),
                0 4px 0 #005555,
                0 5px 10px rgba(0, 0, 0, 0.5);
            transition: all 0.1s;
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
        }

        /* 按钮扫光效果 */
        .nav-toggle::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: button-shine 3s infinite;
        }

        @keyframes button-shine {
            0% {
                transform: translateX(-100%) rotate(45deg);
            }

            20% {
                transform: translateX(100%) rotate(45deg);
            }

            100% {
                transform: translateX(100%) rotate(45deg);
            }
        }

        .nav-toggle:active {
            transform: translateY(4px);
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.4);
        }

        @keyframes nav-grid-scroll {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 20px 20px;
            }
        }

        .nav-list {
            background: #181818;
            /* 科技网格背景 */
            background-image:
                linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: nav-grid-scroll 3s linear infinite;

            border: 2px solid #333;
            border-top: 2px solid var(--accent-cyan);
            /* 顶部科技蓝条 */
            border-bottom: 4px solid #111;
            border-radius: 8px;

            list-style: none;
            padding: 15px;
            margin: 0;
            width: 280px;
            max-height: 80vh;
            overflow-y: auto;

            /* 3D 塑料质感阴影 + 科技微光 */
            box-shadow:
                inset 0 0 30px rgba(0, 0, 0, 0.9),
                0 0 15px rgba(0, 255, 255, 0.1),
                0 10px 30px rgba(0, 0, 0, 0.5);

            position: relative;
        }

        /* 导航栏内部装饰条 */
        .nav-list::before {
            content: "";
            display: block;
            width: 100%;
            height: 4px;
            background: repeating-linear-gradient(90deg,
                    var(--accent-cyan),
                    var(--accent-cyan) 10px,
                    transparent 10px,
                    transparent 20px);
            margin-bottom: 15px;
            opacity: 0.6;
            border-radius: 2px;
        }

        .nav-item {
            margin-bottom: 8px;
            border-bottom: 1px dashed #333;
            padding-bottom: 5px;
        }

        .nav-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .nav-link {
            color: #aaa;
            text-decoration: none;
            font-size: 0.9rem;
            display: block;
            transition: all 0.2s;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 4px 8px;
            border-radius: 2px;
        }

        .nav-link:hover {
            color: #fff;
            background: rgba(0, 255, 255, 0.15);
            text-shadow: 0 0 8px var(--accent-cyan);
            padding-left: 12px;
            border-left: 3px solid var(--accent-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
        }

        .nav-link::before {
            content: "> ";
            color: var(--accent-cyan);
            opacity: 0.5;
            margin-right: 5px;
            transition: opacity 0.2s;
        }

        .nav-link:hover::before {
            opacity: 1;
            text-shadow: 0 0 5px var(--accent-cyan);
        }

        /* Custom Cursor Container - Handles Position Only */
        .custom-cursor {
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            pointer-events: none;
            z-index: 9999;
            opacity: 0;
            /* Start hidden */
            transition: opacity 0.5s ease;
        }

        /* Custom Cursor Visuals - Handles Shape & Animation */
        .cursor-inner {
            position: absolute;
            top: 0;
            left: 0;
            width: 40px;
            height: 40px;
            border: 1px solid var(--accent-green);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s, background-color 0.2s, border-color 0.2s;
            mix-blend-mode: difference;
            box-shadow: 0 0 8px var(--accent-green), inset 0 0 5px rgba(51, 255, 51, 0.2);
            z-index: 2;
        }

        /* CRT Scan Effect Layer */
        .cursor-scan {
            position: absolute;
            top: 0;
            left: 0;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            background: repeating-linear-gradient(to bottom,
                    transparent 0px,
                    transparent 2px,
                    rgba(51, 255, 51, 0.2) 2px,
                    rgba(51, 255, 51, 0.2) 4px);
            background-size: 100% 8px;
            animation: scan-scroll 0.5s linear infinite;
            pointer-events: none;
            z-index: 1;
            backdrop-filter: contrast(1.2) brightness(1.1) blur(0.5px);
            mix-blend-mode: hard-light;
            opacity: 0.6;
            transition: opacity 0.2s, width 0.2s, height 0.2s;
        }

        .custom-cursor.hovered .cursor-scan {
            width: 100px;
            height: 100px;
            opacity: 0.8;
            background: repeating-linear-gradient(to bottom,
                    transparent 0px,
                    transparent 2px,
                    rgba(51, 255, 255, 0.3) 2px,
                    rgba(51, 255, 255, 0.3) 4px);
        }

        @keyframes scan-scroll {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 0 8px;
            }
        }

        /* Center Dot */
        .cursor-inner::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background: var(--accent-green);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 4px #fff;
        }

        /* Crosshair Lines */
        .cursor-inner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                linear-gradient(to bottom, transparent 48%, var(--accent-green) 48%, var(--accent-green) 52%, transparent 52%),
                linear-gradient(to right, transparent 48%, var(--accent-green) 48%, var(--accent-green) 52%, transparent 52%);
            opacity: 0.3;
            border-radius: 50%;
        }

        .custom-cursor.hovered .cursor-inner {
            width: 60px;
            height: 60px;
            background-color: rgba(51, 255, 51, 0.05);
            border-color: var(--accent-cyan);
            border-style: dashed;
            animation: spin 4s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        /* Flat Chip Layout */
        .chip-stack {
            position: relative;
            width: 300px;
            height: 300px;
            margin-top: 2rem;
            /* Removed 3D transforms */
        }

        .layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Layer 1: Substrate (PCB) */
        .layer.substrate {
            background: #0a2a0a;
            border: 1px solid #0f300f;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
        }

        /* Pins pattern */
        .layer.substrate::after {
            content: '';
            position: absolute;
            inset: 5px;
            background-image: radial-gradient(#c5a005 15%, transparent 16%);
            background-size: 10px 10px;
            opacity: 0.3;
        }

        /* Layer 2: Silicon Die (Logic) */
        .layer.die {
            background: rgba(20, 20, 25, 0.95);
            border: 1px solid #555;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 12px;
            padding: 12px;
            box-sizing: border-box;
            /* Deep inset for the "socket" look */
            box-shadow:
                inset 0 0 30px rgba(0, 0, 0, 0.8),
                0 0 0 1px #333,
                0 0 20px rgba(0, 0, 0, 0.5);
            /* Tech corners */
            clip-path: polygon(0 0,
                    100% 0,
                    100% calc(100% - 15px),
                    calc(100% - 15px) 100%,
                    0 100%);
        }

        /* Dynamic Retro Grid Animation */
        @keyframes retro-grid-scroll {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 20px 20px;
            }
        }

        .arch-block {
            border: 1px solid rgba(255, 255, 255, 0.1);
            background:
                linear-gradient(135deg, rgba(30, 30, 35, 0.95), rgba(20, 20, 25, 0.98));
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 10px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;

            /* Enhanced 3D Effect */
            box-shadow:
                inset 1px 1px 0px rgba(255, 255, 255, 0.15),
                inset -1px -1px 0px rgba(0, 0, 0, 0.6),
                0 5px 15px rgba(0, 0, 0, 0.5),
                0 0 0 1px #222;

            transform: perspective(500px) translateZ(0);
        }

        /* Shine effect */
        .arch-block::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to bottom right,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, 0) 40%,
                    rgba(255, 255, 255, 0.1) 50%,
                    rgba(255, 255, 255, 0) 60%,
                    rgba(255, 255, 255, 0) 100%);
            transform: rotate(45deg) translateY(-100%);
            transition: transform 0.5s;
            pointer-events: none;
        }

        @keyframes grid-pulse {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* Add animated grid on hover or always? Let's do always for that "alive" feel */
        .arch-block::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 200%;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: retro-grid-scroll 3s linear infinite, grid-pulse 4s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
            mix-blend-mode: overlay;
        }

        .arch-block:hover {
            transform: perspective(500px) translateZ(10px) translateY(-5px);
            z-index: 10;
        }

        .arch-block:hover::after {
            transform: rotate(45deg) translateY(100%);
            transition: transform 0.8s;
        }

        .cpu-area:hover {
            box-shadow:
                inset 0 0 30px rgba(51, 255, 255, 0.3),
                0 0 25px rgba(51, 255, 255, 0.6),
                0 10px 30px rgba(0, 0, 0, 0.8);
            border-color: var(--accent-cyan);
            background-color: rgba(51, 255, 255, 0.1);
            z-index: 100;
        }

        .gpu-area:hover {
            box-shadow:
                inset 0 0 30px rgba(255, 102, 102, 0.3),
                0 0 25px rgba(255, 102, 102, 0.6),
                0 10px 30px rgba(0, 0, 0, 0.8);
            border-color: var(--accent-red);
            background-color: rgba(255, 102, 102, 0.1);
            z-index: 100;
        }

        .npu-area:hover {
            box-shadow:
                inset 0 0 30px rgba(102, 255, 102, 0.3),
                0 0 25px rgba(102, 255, 102, 0.6),
                0 10px 30px rgba(0, 0, 0, 0.8);
            border-color: var(--accent-green);
            background-color: rgba(102, 255, 102, 0.1);
            z-index: 100;
        }

        .arch-label {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 8px;
            z-index: 2;
            text-shadow: 0 0 5px currentColor;
            background: rgba(0, 0, 0, 0.5);
            /* Legibility */
            padding: 2px 5px;
            border: 1px solid currentColor;
            width: 80%;
            transition: all 0.3s;
        }

        .arch-block:hover .arch-label {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
            transform: scale(1.1);
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 10px currentColor;
        }

        text-align: center;
        }

        /* CPU Area: Top Left */
        .cpu-area {
            grid-column: 1 / 2;
            grid-row: 1 / 2;
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            /* Removed flex-direction: row to align with others */
            gap: 6px;
        }

        .mini-core {
            width: 30%;
            height: 60%;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--accent-cyan);
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
        }

        /* GPU Area: Top Right */
        .gpu-area {
            grid-column: 2 / 3;
            grid-row: 1 / 2;
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        .gpu-grid-mini {
            width: 80%;
            height: 60%;
            background-image: radial-gradient(var(--accent-red) 20%, transparent 20%);
            background-size: 4px 4px;
            opacity: 0.6;
        }

        /* NPU Area: Bottom (Full Width) */
        .npu-area {
            grid-column: 1 / -1;
            grid-row: 2 / 3;
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .npu-array-mini {
            width: 90%;
            height: 60%;
            background: repeating-linear-gradient(45deg,
                    rgba(102, 255, 102, 0.1),
                    rgba(102, 255, 102, 0.1) 5px,
                    transparent 5px,
                    transparent 10px);
            border: 1px dashed var(--accent-green);
        }

        /* Layer 3: Interconnects */
        .layer.interconnect {
            pointer-events: none;
            opacity: 0.5;
        }

        .layer.interconnect::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                linear-gradient(90deg, transparent 95%, rgba(51, 255, 255, 0.2) 95%),
                linear-gradient(0deg, transparent 95%, rgba(51, 255, 255, 0.2) 95%);
            background-size: 20px 20px;
        }

        /* Layer 4: IHS (Heat Spreader) - Hidden for flat view */
        .layer.ihs {
            display: none;
        }

        /* Core Details */
        .core-detail {
            position: absolute;
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid var(--accent-cyan);
            color: #fff;
            font-size: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .core-detail.alu {
            top: 10%;
            left: 10%;
            width: 40%;
            height: 40%;
            background: rgba(255, 100, 100, 0.3);
            border-color: var(--accent-red);
        }

        .core-detail.reg {
            top: 10%;
            right: 10%;
            width: 30%;
            height: 80%;
            background: rgba(100, 255, 100, 0.3);
            border-color: var(--accent-green);
        }

        .core-detail.cache {
            bottom: 10%;
            left: 10%;
            width: 40%;
            height: 30%;
            background: rgba(255, 200, 50, 0.3);
            border-color: var(--accent-amber);
        }

        /* @keyframes float-rotate { ... } Removed to allow manual control */

        .dud {
            color: var(--accent-red);
        }

        /* Advanced CRT Scanline Effect */
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom,
                    rgba(255, 255, 255, 0),
                    rgba(255, 255, 255, 0) 50%,
                    rgba(0, 0, 0, 0.1) 50%,
                    rgba(0, 0, 0, 0.1));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 999;
            animation: scanline 0.2s linear infinite;
            opacity: 0.15;
        }

        /* Vignette & Flicker */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle, rgba(0, 0, 0, 0) 60%, rgba(0, 0, 0, 0.2) 100%);
            pointer-events: none;
            z-index: 998;
            animation: flicker 4s infinite;
        }

        header {
            background-color: rgba(10, 10, 10, 0.9);
            border-bottom: 2px solid var(--accent-green);
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 4px;
            box-shadow: 0 0 20px rgba(51, 255, 51, 0.1);
        }

        header::before {
            content: "/// SYSTEM_BOOT_SEQUENCE_INIT ///";
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 0.7rem;
            color: var(--accent-green);
            opacity: 0.8;
            font-family: monospace;
        }

        header h1 {
            margin: 0;
            font-size: 3.5rem;
            color: #0f0;
            text-shadow:
                0 0 5px #0f0,
                0 0 10px #0f0,
                0 0 20px #0f0;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.1em;
            position: relative;
            display: inline-block;
            animation: matrix-pulse 2s infinite alternate;
            z-index: 2;
        }

        @keyframes matrix-pulse {
            0% {
                opacity: 0.9;
                text-shadow: 0 0 5px #0f0;
            }

            100% {
                opacity: 1;
                text-shadow: 0 0 20px #0f0, 0 0 10px #fff;
            }
        }

        /* Matrix Rain Effect Overlay for Header */
        header::after {
            content: "1010101010101010101010101010101010101010101010101010101010101010";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            color: #0f0;
            opacity: 0.1;
            font-size: 10px;
            word-break: break-all;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        header p {
            font-size: 1rem;
            color: var(--accent-cyan);
            margin-top: 1rem;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
            position: relative;
            z-index: 2;
        }

        .container {
            width: 100vw;
            height: 100vh;
            max-width: none;
            margin: 0;
            padding: 0;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        section {
            /* Slide Styles */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(30, 30, 35, 0.95);
            border: none;
            /* Remove default border for full screen */
            border-radius: 0;
            padding: 4rem;
            box-sizing: border-box;
            /* Ensure padding doesn't cause overflow */
            /* More padding for full screen */
            margin: 0;

            /* Flex center content */
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            /* Changed to flex-start to allow scrolling */
            align-items: center;

            /* Transitions */
            opacity: 0;
            pointer-events: none;
            transform: scale(1.1);
            transition: opacity 0.8s ease, transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: none;
            will-change: opacity, transform;
            overflow-y: auto;
            /* Allow scrolling if content overflows */
            overflow-x: hidden;
        }

        /* Custom Scrollbar for Sections */
        section::-webkit-scrollbar {
            width: 8px;
        }

        section::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        section::-webkit-scrollbar-thumb {
            background: var(--accent-cyan);
            border-radius: 4px;
        }

        section::-webkit-scrollbar-thumb:hover {
            background: #fff;
        }

        section.active {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
            z-index: 10;
        }

        /* Adjust content grid for full screen */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            /* Center vertically */
            width: 100%;
            max-width: 1400px;
        }

        section:hover {
            transform: scale(1);
            /* Disable hover move effect in slide mode */
            box-shadow: none;
            border-color: #444;
        }

        /* Cassette Futurism Color Schemes */
        /* 1. Overview - Retro Amber/Brown */
        section:nth-of-type(1) {
            border-top: 6px solid var(--accent-amber);
            background: linear-gradient(160deg, #2a2520 0%, #1a1a1a 100%);
        }

        /* 2. 3D Intro - Retro Orange */
        section:nth-of-type(2) {
            border-top: 6px solid #ffb000;
            background: linear-gradient(160deg, #2a2010 0%, #1a1a1a 100%);
        }

        /* 3. CPU - Retro Cyan/Slate */
        section:nth-of-type(3) {
            border-top: 6px solid var(--accent-cyan);
            background: linear-gradient(160deg, #1a2a2a 0%, #1a1a1a 100%);
        }

        /* 4. GPU - Retro Red/Maroon */
        section:nth-of-type(4) {
            border-top: 6px solid var(--accent-red);
            background: linear-gradient(160deg, #2a1a1a 0%, #1a1a1a 100%);
        }

        /* 5. NPU - Retro Green/Olive */
        section:nth-of-type(5) {
            border-top: 6px solid var(--accent-green);
            background: linear-gradient(160deg, #1a2a1a 0%, #1a1a1a 100%);
        }

        /* 6. Comparison - Retro Grey/Purple */
        section:nth-of-type(6) {
            border-top: 6px solid #a0a0a0;
            background: linear-gradient(160deg, #252525 0%, #151515 100%);
        }

        /* HUD Corners */
        section::after {
            content: "";
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background:
                linear-gradient(to right, var(--accent-cyan) 2px, transparent 2px) 0 0,
                linear-gradient(to bottom, var(--accent-cyan) 2px, transparent 2px) 0 0,
                linear-gradient(to left, var(--accent-cyan) 2px, transparent 2px) 100% 0,
                linear-gradient(to bottom, var(--accent-cyan) 2px, transparent 2px) 100% 0,
                linear-gradient(to left, var(--accent-cyan) 2px, transparent 2px) 100% 100%,
                linear-gradient(to top, var(--accent-cyan) 2px, transparent 2px) 100% 100%,
                linear-gradient(to right, var(--accent-cyan) 2px, transparent 2px) 0 100%,
                linear-gradient(to top, var(--accent-cyan) 2px, transparent 2px) 0 100%;
            background-size: 15px 15px;
            background-repeat: no-repeat;
            pointer-events: none;
            opacity: 0.7;
        }

        section::before {
            content: "MODULE_0" counter(section-counter);
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--bg-color);
            padding: 0 10px;
            color: var(--accent-cyan);
            font-size: 0.7rem;
            border: 1px solid var(--accent-cyan);
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
            z-index: 2;
        }

        body {
            counter-reset: section-counter;
        }

        section {
            counter-increment: section-counter;
        }

        h2 {
            color: var(--accent-amber);
            border-bottom: 1px dashed var(--text-main);
            padding-bottom: 0.5rem;
            margin-top: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(255, 176, 0, 0.3);
            transition: text-shadow 0.2s;
        }

        h2:hover {
            text-shadow: 2px 0 var(--accent-red), -2px 0 var(--accent-cyan);
        }

        h3 {
            color: var(--accent-cyan);
            margin-top: 1.5rem;
            text-transform: uppercase;
            font-size: 1rem;
            letter-spacing: 1px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: start;
        }

        @media (max-width: 900px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .image-container {
                margin-top: 1rem;
            }
        }

        .image-container {
            text-align: center;
            background: #181818;
            /* 模拟塑料外壳 */
            border: 4px solid #2a2a2a;
            border-radius: 15px;
            padding: 1.5rem;
            position: relative;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow: hidden;

            /* 3D 塑料质感阴影 */
            box-shadow:
                /* 顶部高光 */
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                /* 内部深邃感 */
                inset 0 0 40px rgba(0, 0, 0, 0.8),
                /* 外部投影 */
                0 10px 30px rgba(0, 0, 0, 0.5),
                /* 底部厚度 */
                0 6px 0 #111;
        }

        /* 装饰性条纹 - 磁带风格 */
        .image-container::before {
            content: "";
            position: absolute;
            bottom: 12px;
            right: 15px;
            width: 80px;
            height: 6px;
            background: repeating-linear-gradient(-45deg,
                    var(--accent-red),
                    var(--accent-red) 5px,
                    transparent 5px,
                    transparent 10px,
                    var(--accent-amber) 10px,
                    var(--accent-amber) 15px,
                    transparent 15px,
                    transparent 20px);
            z-index: 2;
            opacity: 0.8;
            border-radius: 2px;
            box-shadow: 0 0 5px rgba(255, 100, 100, 0.3);
        }

        /* 扫描线纹理 + 顶部装饰点 */
        .image-container::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                /* 顶部装饰点 */
                radial-gradient(circle at 15px 15px, var(--accent-cyan) 2px, transparent 3px),
                radial-gradient(circle at 25px 15px, #333 2px, transparent 3px),
                radial-gradient(circle at 35px 15px, #333 2px, transparent 3px),
                /* 扫描线 */
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 100% 4px;
            pointer-events: none;
            z-index: 1;
        }

        .image-container svg {
            cursor: pointer;
            position: relative;
            z-index: 0;
            /* 稍微增加一点对比度 */
            filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.5));
        }

        .image-container:hover {
            border-color: #444;
            transform: translateY(-4px);
            box-shadow:
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 0 20px rgba(0, 0, 0, 0.5),
                0 20px 40px rgba(0, 255, 255, 0.1),
                0 10px 0 var(--accent-cyan);
            /* 底部厚度变色，产生发光感 */
        }

        .image-caption {
            font-size: 0.7rem;
            color: var(--accent-cyan);
            margin-top: 0.5rem;
            font-family: monospace;
            border-top: 1px solid #222;
            padding-top: 5px;
            display: block;
            text-align: left;
            opacity: 0.8;
        }

        .image-caption::before {
            content: "> ";
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        /* Comparison Table */
        .tech-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .tech-table th,
        .tech-table td {
            border: 1px solid #333;
            padding: 10px;
            text-align: left;
        }

        .tech-table th {
            background-color: rgba(0, 255, 255, 0.1);
            color: var(--accent-cyan);
            text-transform: uppercase;
        }

        .tech-table tr:hover td {
            background-color: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        /* --- Chip Internal Details CSS --- */
        .mini-core-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 4px;
            height: 60%;
            margin-bottom: 4px;
            width: 80%;
            /* Align width with GPU/NPU internal containers */
        }

        .mini-core {
            border: 1px solid var(--accent-cyan);
            background: rgba(0, 243, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            color: var(--accent-cyan);
            box-shadow: 0 0 5px rgba(0, 243, 255, 0.2);
            transition: all 0.3s;
        }

        .mini-cache {
            width: 80%;
            height: 25%;
            border: 1px solid var(--accent-amber);
            background: rgba(255, 176, 0, 0.15);
            color: var(--accent-amber);
            font-size: 9px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: auto;
            box-shadow: 0 0 5px rgba(255, 176, 0, 0.2);
        }

        .gpu-grid-mini {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 2px;
            height: 80%;
            width: 80%;
        }

        .mini-sm {
            background: var(--accent-red);
            opacity: 0.4;
            border: 1px solid rgba(255, 50, 50, 0.3);
        }

        .mini-sm:nth-child(odd) {
            opacity: 0.7;
            background: rgba(255, 50, 50, 0.6);
            box-shadow: 0 0 3px var(--accent-red);
        }

        .npu-layout-mini {
            display: flex;
            flex-direction: row;
            height: 80%;
            width: 90%;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .npu-layout-mini .npu-buffer {
            width: 15%;
            height: 100%;
            border: 1px solid var(--accent-green);
            font-size: 10px;
            font-weight: bold;
            writing-mode: vertical-rl;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-green);
            background: rgba(50, 255, 50, 0.1);
            letter-spacing: 1px;
            text-shadow: 0 0 2px var(--accent-green);
        }

        .npu-array-mini {
            flex: 1;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 2px;
            border: 1px dashed var(--accent-green);
            padding: 2px;
            background: rgba(0, 20, 0, 0.3);
        }

        .systolic-cell {
            background: var(--accent-green);
            opacity: 0.4;
            border-radius: 50%;
            box-shadow: 0 0 2px var(--accent-green);
            animation: pulse-cell 1s infinite alternate;
        }

        @keyframes pulse-cell {
            from {
                opacity: 0.3;
                transform: scale(0.8);
            }

            to {
                opacity: 0.8;
                transform: scale(1.1);
            }
        }

        .npu-activation {
            width: 15%;
            height: 100%;
            background: rgba(51, 255, 0, 0.1);
            border: 1px solid var(--accent-green);
            font-size: 8px;
            writing-mode: vertical-rl;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-green);
            letter-spacing: 1px;
            text-shadow: 0 0 2px var(--accent-green);
        }

        .click-hint {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 8px;
            color: #fff;
            background: #000;
            padding: 1px 3px;
            border: 1px solid #fff;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .arch-block:hover .click-hint {
            opacity: 1;
            animation: blink 1s infinite;
        }

        .arch-block {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .arch-block:hover {
            transform: translateZ(5px);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            z-index: 10;
        }

        /* --- Detail Overlay --- */
        #detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            /* Hidden by default */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        #detail-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .detail-content {
            width: 80%;
            height: 80%;
            position: relative;
            perspective: 1000px;
            border: 2px solid var(--text-main);
            background: #111;
            overflow: hidden;
            /* Clip content */
            display: flex;
            flex-direction: column;
        }

        .detail-header {
            padding: 1rem;
            border-bottom: 2px solid var(--text-main);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #222;
            z-index: 10;
        }

        .detail-title {
            font-size: 2rem;
            color: var(--accent-amber);
            text-transform: uppercase;
        }

        .detail-close-btn {
            background: transparent;
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .detail-close-btn:hover {
            background: var(--accent-red);
            color: #000;
            box-shadow: 0 0 15px var(--accent-red);
            transform: rotate(90deg);
        }

        .detail-viewport {
            flex: 1;
            position: relative;
            overflow: hidden;
            /* Hide scrollbars, we use wheel */
            background:
                linear-gradient(rgba(18, 16, 16, 0.9), rgba(18, 16, 16, 0.9)),
                linear-gradient(0deg, transparent 24%, rgba(0, 255, 255, .05) 25%, rgba(0, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(0, 255, 255, .05) 75%, rgba(0, 255, 255, .05) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(0, 255, 255, .05) 25%, rgba(0, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(0, 255, 255, .05) 75%, rgba(0, 255, 255, .05) 76%, transparent 77%, transparent);
            background-size: 100% 100%, 40px 40px, 40px 40px;
            cursor: grab;
        }

        .detail-viewport::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 200%;
            background-image:
                linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: retro-grid-scroll 10s linear infinite;
            pointer-events: none;
            z-index: 0;
        }
        }

        .detail-viewport:active {
            cursor: grabbing;
        }

        .detail-scene {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-style: preserve-3d;
            /* Initial transform set by JS */
        }

        /* Specific Detail Views */
        .detail-view-cpu,
        .detail-view-gpu,
        .detail-view-npu {
            width: 560px;
            height: 380px;
            position: absolute;
            top: -190px;
            /* Center it (half of height) */
            left: -280px;
            /* Center it (half of width) */
            /* Dynamic Grid Background */
            background:
                linear-gradient(rgba(20, 20, 20, 0.95), rgba(20, 20, 20, 0.95)),
                linear-gradient(0deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent);
            background-size: 100% 100%, 20px 20px, 20px 20px;
            border: 2px solid;
            display: none;
            /* Show specific one via JS */
            padding: 20px;
            box-sizing: border-box;
            /* 3D Effect */
            box-shadow:
                inset 1px 1px 0px rgba(255, 255, 255, 0.1),
                inset -1px -1px 0px rgba(0, 0, 0, 0.5),
                0 0 0 2px #000,
                10px 10px 0px rgba(0, 0, 0, 0.8);
            transform-style: preserve-3d;
        }

        /* Add animation to detail view background */
        .detail-view-cpu::before,
        .detail-view-gpu::before,
        .detail-view-npu::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: retro-grid-scroll 4s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        .detail-view-cpu {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
        }

        .detail-view-gpu {
            border-color: var(--accent-red);
            box-shadow: 0 0 30px rgba(255, 51, 51, 0.2);
        }

        .detail-view-npu {
            border-color: var(--accent-green);
            box-shadow: 0 0 30px rgba(51, 255, 0, 0.2);
        }

        /* --- Detail View Internal Animations & 3D Styles --- */

        /* CPU Styles */
        .cpu-core-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            height: 85%;
            padding: 20px;
        }

        .cpu-core {
            position: relative;
            border: 1px solid var(--accent-cyan);
            padding: 15px;
            background: rgba(0, 20, 20, 0.85);
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 0 20px rgba(0, 255, 255, 0.1), 0 0 0 1px rgba(0, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .cpu-core:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3);
        }

        .core-title {
            text-align: center;
            color: var(--accent-cyan);
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 5px;
            text-shadow: 0 0 5px var(--accent-cyan);
        }

        .cpu-control {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid var(--accent-amber);
            color: var(--accent-amber);
            padding: 8px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: inset 0 0 5px rgba(255, 255, 0, 0.2);
        }

        .cpu-exec-group {
            display: flex;
            gap: 10px;
            flex: 1;
        }

        .cpu-unit {
            flex: 1;
            background: rgba(0, 243, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0, 243, 255, 0.3);
            box-shadow: inset 0 0 5px rgba(0, 243, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, background 0.2s;
            font-size: 0.8rem;
            text-align: center;
        }

        .cpu-unit:hover {
            transform: scale(1.05);
            background: rgba(0, 243, 255, 0.25);
            box-shadow: 0 0 15px var(--accent-cyan);
            z-index: 2;
        }

        .cpu-cache-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .cpu-cache {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
            padding: 5px;
            text-align: center;
            font-size: 0.8rem;
        }

        .cpu-cache.l1 {
            opacity: 0.8;
        }

        .cpu-cache.l2 {
            opacity: 0.6;
            font-size: 0.7rem;
        }

        /* Bus & L3 Styles */
        .cpu-bus-container {
            height: 30px;
            display: flex;
            justify-content: space-around;
            padding: 0 20px;
            position: relative;
        }

        .bus-line-group {
            width: 4px;
            height: 100%;
            position: relative;
        }

        .bus-line {
            width: 100%;
            height: 100%;
            background: rgba(255, 191, 0, 0.3);
            box-shadow: 0 0 5px rgba(255, 191, 0, 0.1);
            transition: all 0.3s;
        }

        .bus-packet-down,
        .bus-packet-up {
            position: absolute;
            left: 0;
            width: 100%;
            height: 6px;
            background: #fff;
            opacity: 0;
            box-shadow: 0 0 5px #fff;
        }

        .cpu-l3-cache {
            margin-top: 0;
            border: 1px solid var(--accent-amber);
            color: var(--accent-amber);
            padding: 10px;
            background: rgba(255, 191, 0, 0.1);
            box-shadow: inset 0 0 10px rgba(255, 191, 0, 0.2);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cpu-l3-cache:hover {
            background: rgba(255, 191, 0, 0.2);
            box-shadow: inset 0 0 20px rgba(255, 191, 0, 0.4), 0 0 15px rgba(255, 191, 0, 0.3);
        }

        .l3-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(90deg, rgba(255, 191, 0, 0.1) 1px, transparent 1px);
            background-size: 20px 100%;
            opacity: 0.3;
            pointer-events: none;
        }

        /* Interaction States */
        .cpu-core.active {
            border-color: var(--accent-amber);
            box-shadow: 0 0 20px rgba(255, 191, 0, 0.3);
        }

        .bus-line-group.active .bus-line {
            background: var(--accent-amber);
            box-shadow: 0 0 10px var(--accent-amber);
        }

        .bus-line-group.flow-down .bus-packet-down {
            animation: bus-flow-down 0.5s linear infinite;
        }

        .bus-line-group.flow-up .bus-packet-up {
            animation: bus-flow-up 0.5s linear infinite;
        }

        @keyframes bus-flow-down {
            0% {
                top: 0;
                opacity: 1;
            }

            100% {
                top: 100%;
                opacity: 0;
            }
        }

        @keyframes bus-flow-up {
            0% {
                top: 100%;
                opacity: 1;
            }

            100% {
                top: 0;
                opacity: 0;
            }
        }

        .cpu-unit::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.6), transparent);
            animation: cpu-process 2s infinite;
        }

        @keyframes cpu-process {
            0% {
                left: -100%;
            }

            50% {
                left: 200%;
            }

            100% {
                left: 200%;
            }
        }

        /* GPU Styles */
        .gpu-grid-container {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 8px;
            height: 80%;
            padding: 20px;
        }

        .gpu-core-unit {
            position: relative;
            background: rgba(60, 10, 10, 0.6);
            border: 1px solid rgba(255, 51, 51, 0.3);
            transition: all 0.2s;
        }

        /* Removed 3D Faces */

        @keyframes gpu-flicker {

            0%,
            100% {
                opacity: 0.4;
                transform: scale(1);
                background: rgba(60, 10, 10, 0.6);
                box-shadow: none;
            }

            50% {
                opacity: 1;
                transform: scale(1.1);
                /* Pop out effect */
                background: rgba(255, 51, 51, 0.8);
                box-shadow:
                    0 0 20px var(--accent-red),
                    inset 0 0 10px rgba(255, 255, 255, 0.4);
                border-color: #fff;
                z-index: 10;
            }
        }

        /* NPU Styles */
        .npu-container {
            display: flex;
            height: 80%;
            gap: 30px;
            perspective: 1000px;
            overflow: visible;
            padding: 20px;
            align-items: center;
        }

        .npu-buffer {
            width: 10%;
            height: 80%;
            border: 1px solid var(--accent-green);
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            background: rgba(0, 20, 0, 0.5);
            box-shadow: inset 0 0 10px rgba(51, 255, 0, 0.1);
            text-shadow: 0 0 5px var(--accent-green);
            transform: rotateY(10deg);
            /* Slight 3D angle */
            font-size: 1.5rem;
            font-weight: bold;
            letter-spacing: 5px;
        }

        .npu-array {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 8px;
            padding: 10px;
            background: rgba(0, 20, 0, 0.4);

            /* Isometric 3D View for Systolic Array */
            transform: rotateX(60deg) rotateZ(-45deg);
            transform-style: preserve-3d;
            box-shadow: 20px 20px 60px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(102, 255, 102, 0.2);
            margin: 0 20px;
        }

        .npu-node {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            background: rgba(0, 40, 0, 0.6);
            border: 1px solid rgba(102, 255, 102, 0.1);
        }

        /* Top Face (The active part) */
        .npu-node::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(102, 255, 102, 0.8);
            transform: translateZ(1px);
            box-shadow: 0 0 5px var(--accent-green);
            opacity: 0.8;
        }

        /* Side/Body (Visualized by the gap and movement) */

        @keyframes npu-pulse {

            0%,
            100% {
                transform: translateZ(0px);
                filter: brightness(0.5);
            }

            50% {
                transform: translateZ(50px);
                /* High 3D pop */
                filter: brightness(1.5);
                box-shadow: 0 0 20px var(--accent-green);
            }
        }

        .detail-info-panel {
            position: relative;
            width: 100%;
            background: #111;
            border-top: 1px solid #555;
            padding: 10px 20px;
            color: #ccc;
            font-size: 0.9rem;
            z-index: 20;
            flex-shrink: 0;
            box-sizing: border-box;
        }

        .zoom-controls {
            display: flex;
            gap: 10px;
            margin-right: 20px;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            background: #222;
            border: 1px solid var(--text-main);
            color: var(--text-main);
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background: #333;
        }

        /* SVG Styles */
        svg text {
            font-family: 'Share Tech Mono', monospace;
            fill: var(--text-main);
        }

        svg rect,
        svg path,
        svg line,
        svg circle {
            stroke-width: 1.5;
            vector-effect: non-scaling-stroke;
            transition: all 0.3s ease;
        }

        /* Scroll Reveal */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease-out;
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        .chip-icon {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 8px;
        }

        .cpu-color {
            background-color: var(--accent-cyan);
        }

        .gpu-color {
            background-color: var(--accent-red);
        }

        .npu-color {
            background-color: var(--accent-green);
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: #aaa;
            font-size: 0.7rem;
            border-top: 1px solid #222;
            margin-top: 2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Modal Styles */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-backdrop.active {
            display: flex;
            opacity: 1;
        }

        .modal-card {
            background: #222;
            border: 4px solid #333;
            /* Retro thick border */
            border-radius: 10px;
            /* Rounded corners like old monitors */
            padding: 25px;
            width: 90%;
            max-width: 450px;
            position: relative;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow:
                0 0 0 4px #000,
                /* Inner black outline */
                0 0 20px rgba(0, 0, 0, 0.8),
                inset 0 0 30px rgba(0, 0, 0, 0.8);
            /* Inner shadow */
            background-image:
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            /* CRT Scanlines */
        }

        .modal-card::before {
            content: "SYSTEM_DIAGNOSTIC_TOOL_V1.0";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #222;
            padding: 0 10px;
            font-size: 0.7rem;
            color: #aaa;
            letter-spacing: 2px;
            border: 1px solid #333;
        }

        .modal-backdrop.active .modal-card {
            transform: scale(1) translateY(0);
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.2rem;
            cursor: pointer;
            color: #444;
            background: #111;
            border: 1px solid #444;
            width: 24px;
            height: 24px;
            line-height: 22px;
            text-align: center;
            z-index: 10;
            transition: all 0.2s;
        }

        .close-btn:hover {
            color: var(--accent-red);
            border-color: var(--accent-red);
            box-shadow: 0 0 8px var(--accent-red);
        }

        .arch-trigger {
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
            border: 1px solid transparent;
            padding: 5px 10px;
            /* Button-like padding */
            background: rgba(0, 0, 0, 0.3);
            /* Subtle background */
            border-radius: 4px;
        }

        .arch-trigger:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: currentColor;
            box-shadow: 0 0 10px currentColor;
            text-shadow: 0 0 8px currentColor;
            transform: translateY(-2px);
        }

        .arch-trigger::after {
            content: " [VIEW]";
            font-size: 0.7em;
            opacity: 0;
            margin-left: 5px;
            transition: opacity 0.2s;
        }

        .arch-trigger:hover::after {
            opacity: 1;
        }

        @keyframes text-flicker {

            0%,
            100% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            3% {
                opacity: 0.8;
                text-shadow: 0 0 10px var(--accent-cyan);
            }

            6% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            7% {
                opacity: 0.9;
                text-shadow: 0 0 15px var(--accent-cyan);
            }

            8% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            9% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            10% {
                opacity: 0.95;
                text-shadow: 0 0 18px var(--accent-cyan);
            }

            11% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            23% {
                opacity: 0.9;
                text-shadow: 0 0 15px var(--accent-cyan);
            }

            24% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            35% {
                opacity: 0.85;
                text-shadow: 0 0 12px var(--accent-cyan);
            }

            36% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            42% {
                opacity: 0.8;
                text-shadow: 0 0 10px var(--accent-cyan);
            }

            43% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            50% {
                opacity: 0.95;
                text-shadow: 0 0 18px var(--accent-cyan);
            }

            55% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            62% {
                opacity: 0.9;
                text-shadow: 0 0 15px var(--accent-cyan);
            }

            63% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            70% {
                opacity: 0.9;
                text-shadow: 0 0 15px var(--accent-cyan);
            }

            71% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            80% {
                opacity: 0.8;
                text-shadow: 0 0 10px var(--accent-cyan);
            }

            81% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }

            85% {
                opacity: 0.95;
                text-shadow: 0 0 18px var(--accent-cyan);
            }

            92% {
                opacity: 0.9;
                text-shadow: 0 0 15px var(--accent-cyan);
            }

            93% {
                opacity: 1;
                text-shadow: 0 0 20px var(--accent-cyan);
            }
        }

        .title-flicker {
            animation: text-flicker 3s infinite;
        }

        @keyframes author-pulse {

            0%,
            100% {
                opacity: 0.7;
                text-shadow: 0 0 5px var(--accent-amber);
                transform: scale(1);
            }

            50% {
                opacity: 1;
                text-shadow: 0 0 15px var(--accent-amber);
                transform: scale(1.05);
            }
        }

        @keyframes protocol-blink {

            0%,
            50% {
                opacity: 1;
                text-shadow: 0 0 10px var(--accent-cyan);
            }

            51%,
            100% {
                opacity: 0;
                text-shadow: none;
            }
        }

        .protocol-text {
            /* Animation handled by JS */
        }

        .author-glow {
            animation: author-pulse 3s infinite ease-in-out;
            display: inline-block;
        }

        /* Retro Grid Background Animation */
        .retro-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
            perspective: 300px;
            /* Add perspective for 3D effect */
        }

        .retro-grid::before {
            content: "";
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background-image:
                linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 60px 60px;
            transform-origin: center;
            animation: grid-pan 10s linear infinite;
        }

        @keyframes grid-pan {
            0% {
                transform: rotateX(45deg) translateY(0);
            }

            100% {
                transform: rotateX(45deg) translateY(60px);
            }
        }

        /* Ensure content sits above the grid */
        section>*:not(.retro-grid) {
            position: relative;
            z-index: 2;
        }

        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 20;
            pointer-events: none;
            opacity: 0.6;
        }
    </style>
</head>

<body>
    <!-- Background Music -->
    <audio id="bgm-audio" loop autoplay>
        <source src="music/Hans Zimmer - Risen from Darkness_L.ogg" type="audio/ogg">
    </audio>

    <!-- Music Controls Container -->
    <div class="music-controls-container"
        style="position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; gap: 10px;">
        <!-- Music Toggle Switch -->
        <div class="music-toggle" id="music-toggle" style="position: relative; top: auto; right: auto; margin: 0;">
            <span id="music-icon">🔇</span> <span id="music-text">BGM: OFF</span>
        </div>
        <!-- Next Song Button -->
        <div class="music-toggle" id="music-next"
            style="position: relative; top: auto; right: auto; margin: 0; padding: 6px 10px;" title="下一首">
            <span>⏭</span>
        </div>
    </div>

    <!-- Navigation Menu -->
    <div class="nav-trigger-area"></div>
    <div class="nav-menu-container">
        <div class="nav-toggle">/// 系统导航目录 ///</div>
        <ul class="nav-list" id="nav-list">
            <!-- Items injected by JS -->
        </ul>
    </div>

    <div class="universe-bg">
        <div class="stars"></div>
        <div class="stars2"></div>
        <div class="stars3"></div>
    </div>

    <div class="container">
        <!-- Title Slide -->
        <section class="reveal active"
            style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
            <h1 class="title-flicker"
                style="font-size: 5rem; margin-bottom: 3rem; text-shadow: 0 0 20px var(--accent-cyan);">芯力量 智万物</h1>
            <p class="protocol-text" style="font-size: 1.5rem; letter-spacing: 5px; color: var(--accent-cyan);">
                CORE_POWER_INTELLIGENT_UNIVERSE_INIT</p>
            <p style="margin-top: 3rem; font-size: 1.2rem; letter-spacing: 2px; color: var(--text-main);">
                分享人 : <span class="author-glow" style="color: var(--accent-amber); font-weight: bold;">史蒂芬猴</span>
            </p>
        </section>


        <!-- PART I: Introduction -->
        <section class="reveal">
            <h2>01_开篇：核心问题 (Introduction)</h2>
            <div class="content-grid">
                <div style="text-align: left;">
                    <h3 style="color: var(--accent-amber);">处理器分化疑问</h3>
                    <p>CPU、GPU、NPU名称仅差一个单词，却成为三类不同计算芯片，为何需要这种分化？三者核心区别是什么？</p>

                    <h3 style="color: var(--accent-cyan);">类比理解难点</h3>
                    <p>网上常将：</p>
                    <ul>
                        <li><strong>CPU</strong> 比作“全能博士生”（擅长复杂任务）</li>
                        <li><strong>GPU</strong> 比作“一群小学生”（擅长多简单任务）</li>
                    </ul>
                    <p>但“复杂任务”的具体定义、GPU“计算图形”的逻辑仍不明确。</p>
                </div>
                <div class="image-container">
                    <svg width="100%" height="200" viewBox="0 0 400 200"
                        style="background: #111; border: 1px solid #333;">
                        <text x="200" y="100" fill="white" font-size="24" text-anchor="middle">CPU vs GPU vs NPU</text>
                        <text x="200" y="130" fill="#aaa" font-size="14" text-anchor="middle">Why the
                            differentiation?</text>
                        <rect x="50" y="50" width="300" height="100" fill="none" stroke="var(--accent-cyan)"
                            stroke-width="2" stroke-dasharray="5,5">
                            <animate attributeName="stroke-dashoffset" from="0" to="100" dur="5s"
                                repeatCount="indefinite" />
                        </rect>
                    </svg>
                </div>
            </div>
        </section>

        <!-- PART II: GPU Design Logic -->
        <section class="reveal">
            <h2>02_GPU设计逻辑 (GPU Design Logic)</h2>
            <div class="content-grid">
                <div>
                    <h3 style="color: var(--accent-red);">从3D图形计算看CPU的局限</h3>
                    <p><strong>3D模型的底层构成：</strong> 3D模型由三角形组成，三角形由线条构成；线条在计算机中仅存储“两个顶点坐标”，中间所有点需实时计算。</p>
                    <p><strong>CPU的计算瓶颈：</strong> 计算线条中间点时，虽仅涉及“乘法+加法”重复运算，但CPU只能“逐个点计算”，完成一个3D模型的顶点计算耗时极长。</p>
                </div>
                <div>
                    <h3 style="color: var(--accent-red);">GPU的诞生思路与核心特点</h3>
                    <p><strong>设计灵感：</strong> 既然是重复简单运算，可制造“多个仅处理乘加的计算单元”，由控制器装填数据，所有单元同时工作（并行计算）。</p>
                    <p><strong>硬件定义：</strong> 英伟达显卡中，这类计算单元称为“CUDA核心”，GPU核心策略是“单指令多数据”。</p>
                    <p><strong>局限性：</strong> 无法处理“代码依赖场景”（如每行代码执行需依赖上一行结果），此时需逐行计算，并行优势失效。</p>
                </div>
            </div>
        </section>

        <!-- PART III: CPU Core Advantages -->
        <section class="reveal">
            <h2>03_CPU核心优势 (CPU Core Advantages)</h2>
            <div class="content-grid">
                <div>
                    <h3 style="color: var(--accent-cyan);">CPU与GPU处理分支任务的差异</h3>
                    <p><strong>CPU的高效处理：</strong> 以“A=3时判断并执行B=6”代码为例，CPU仅需1次计算，可直接跳转至目标代码，符合人类直觉。</p>
                    <p><strong>GPU的冗余计算：</strong> 传统GPU无法执行跳转指令，需先计算“所有可能结果”（如temp1、temp2），再根据条件赋值，存在无效计算。</p>
                </div>
                <div>
                    <h3 style="color: var(--accent-cyan);">CPU的硬件与功能侧重</h3>
                    <p><strong>核心能力：</strong> 专注逻辑处理，通过“分支预测”技术提升条件语句处理效率。</p>
                    <p><strong>硬件结构：</strong> 单个CPU核心中，大量电路用于分支预测，适配多逻辑判断场景。</p>
                </div>
            </div>
        </section>

        <!-- PART IV: GPU Expansion -->
        <section class="reveal">
            <h2>04_GPU功能扩展 (GPU Expansion)</h2>
            <div class="content-grid">
                <div>
                    <h3 style="color: var(--accent-red);">GPU的传统核心场景：图形渲染</h3>
                    <p><strong>硬件支撑：</strong> 靠“堆叠计算核心”实现高效，如10年前的GTX980显卡含2048个CUDA核心，适配大量重复运算。</p>
                    <p><strong>游戏场景分工：</strong> CPU计算“角色是否动、如何动”的逻辑，GPU负责在指定位置渲染角色图像。</p>
                </div>
                <div>
                    <h3 style="color: var(--accent-red);">GPU向AI领域延伸（GPGPU）</h3>
                    <p><strong>AI计算契合点：</strong> 神经网络核心是“矩阵运算”，拆分后为大量并行乘加运算，与GPU优势匹配。</p>
                    <p><strong>现代GPU三大计算模块：</strong></p>
                    <ul>
                        <li><strong>RT Core：</strong> 负责光线追踪</li>
                        <li><strong>CUDA核心：</strong> 处理图形渲染与通用科学计算</li>
                        <li><strong>Tensor核心：</strong> 加速神经网络计算</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- PART V: NPU Birth -->
        <section class="reveal">
            <h2>05_NPU的诞生 (Birth of NPU)</h2>
            <div class="content-grid">
                <div>
                    <h3 style="color: var(--accent-green);">NPU的设计背景</h3>
                    <p><strong>需求痛点：</strong> 仅需AI计算时，买显卡成本高；边缘计算场景要求设备小型化，无法容纳传统电脑硬件。</p>
                    <p><strong>核心定位：</strong> 专门用于“神经网络加速”的独立芯片。</p>
                </div>
                <div>
                    <h3 style="color: var(--accent-green);">NPU的硬件与能力特点</h3>
                    <p><strong>核心优势：</strong> 从硬件层面直接进行矩阵运算，大幅提升计算效率。</p>
                    <p><strong>案例：</strong> 华为升腾AI服务器NPU</p>
                    <ul>
                        <li><strong>核心单元：</strong> “Cube Core”，支持矩阵相乘</li>
                        <li><strong>辅助单元：</strong> 含标量、矢量计算单元</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- PART VI: Summary -->
        <section class="reveal">
            <h2>06_总结 (Summary)</h2>
            <div style="width: 100%; max-width: 1000px; margin: 0 auto;">
                <table class="tech-table">
                    <thead>
                        <tr>
                            <th>处理器类型</th>
                            <th>定位</th>
                            <th>核心优势</th>
                            <th>适用场景</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="color: var(--accent-cyan); font-weight: bold;">CPU</td>
                            <td>通用型处理器</td>
                            <td>处理复杂逻辑、多类型数学运算</td>
                            <td>系统逻辑控制、分支任务判断</td>
                        </tr>
                        <tr>
                            <td style="color: var(--accent-red); font-weight: bold;">GPU</td>
                            <td>半通用型处理器（GPGPU）</td>
                            <td>大量并行重复运算、图形渲染</td>
                            <td>3D游戏渲染、科学计算、AI训练</td>
                        </tr>
                        <tr>
                            <td style="color: var(--accent-green); font-weight: bold;">NPU</td>
                            <td>AI特化处理器</td>
                            <td>硬件级矩阵运算、低功耗、灵活部署</td>
                            <td>神经网络加速、边缘AI计算、AI推理</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

    </div>

    <footer>
        <p>GENERATED_BY_AI_ASSISTANT // TERMINAL_SESSION_END</p>
        <p>2025 © CORP_DATA_SYSTEMS</p>
    </footer>

    <script>
        // Inject Retro Grid into each section
        document.querySelectorAll('section').forEach(section => {
            const grid = document.createElement('div');
            grid.classList.add('retro-grid');
            section.insertBefore(grid, section.firstChild);
        });

        // PPT Navigation Logic
        const slides = document.querySelectorAll(".reveal");
        let currentSlide = 0;

        // Generate Navigation Menu
        const navList = document.getElementById('nav-list');
        if (navList) {
            slides.forEach((slide, index) => {
                // Try to find a title
                let title = "SLIDE_" + index;
                const h1 = slide.querySelector('h1');
                const h2 = slide.querySelector('h2');

                if (h1) title = "芯力量首页";
                else if (h2) title = h2.innerText.split('(')[0].trim(); // Take main part

                // Truncate if too long
                if (title.length > 28) title = title.substring(0, 28) + "...";

                const li = document.createElement('li');
                li.classList.add('nav-item');

                const a = document.createElement('a');
                a.classList.add('nav-link');
                a.innerText = title;
                a.onclick = (e) => {
                    e.stopPropagation(); // Prevent document click
                    currentSlide = index;
                    showSlide(currentSlide);
                };

                li.appendChild(a);
                navList.appendChild(li);
            });
        }

        function showSlide(index) {
            slides.forEach((slide, i) => {
                if (i === index) {
                    slide.classList.add("active");
                    // Reset animations if needed
                    const svg = slide.querySelector('svg');
                    if (svg && svg.setCurrentTime) svg.setCurrentTime(0);
                } else {
                    slide.classList.remove("active");
                }
            });
        }

        // Initialize first slide
        showSlide(currentSlide);

        // Mouse Navigation
        document.addEventListener('mousedown', (e) => {
            // Ignore clicks on interactive elements like buttons or links or modals or the interactive chip or detail overlay or music toggle
            if (e.target.closest('button') || e.target.closest('a') || e.target.closest('.modal-card') || e.target.closest('.close-btn') || e.target.closest('.chip-stack') || e.target.closest('#detail-overlay') || e.target.closest('.music-toggle') || e.target.closest('#model-3d-container')) return;

            // Ignore clicks on scrollbar
            // If the target is the section (which has the scrollbar), check if click is outside client area
            if (e.target.tagName === 'SECTION') {
                if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {
                    return;
                }
            }

            if (e.button === 0) { // Left Click -> Next
                if (currentSlide < slides.length - 1) {
                    currentSlide++;
                    showSlide(currentSlide);
                }
            } else if (e.button === 2) { // Right Click -> Prev
                if (currentSlide > 0) {
                    currentSlide--;
                    showSlide(currentSlide);
                }
            }
        });

        // Prevent Context Menu on Right Click
        document.addEventListener('contextmenu', event => event.preventDefault());

        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                if (currentSlide < slides.length - 1) {
                    currentSlide++;
                    showSlide(currentSlide);
                }
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                if (currentSlide > 0) {
                    currentSlide--;
                    showSlide(currentSlide);
                }
            }
        });

        // Typing effect
        const headerText = "CORE_POWER_INTELLIGENT_UNIVERSE_INIT";
        const headerP = document.querySelector('.protocol-text');

        if (headerP) {
            function runTyping(onComplete) {
                headerP.innerText = "";
                let i = 0;
                function type() {
                    if (i < headerText.length) {
                        headerP.innerHTML += headerText.charAt(i);
                        i++;
                        setTimeout(type, 50);
                    } else {
                        if (onComplete) onComplete();
                    }
                }
                type();
            }

            // Initial run
            setTimeout(() => {
                runTyping(() => {
                    // Start loop after 5s from page load (approx 2.2s after finish)
                    setTimeout(loopTyping, 2200);
                });
            }, 1000);

            function loopTyping() {
                runTyping(() => {
                    // Wait 2s before retyping
                    setTimeout(loopTyping, 2000);
                });
            }
        }

        // --- Advanced Interaction Scripts ---

        // 1. Optimized Custom Cursor Logic
        const cursor = document.createElement('div');
        cursor.classList.add('custom-cursor');

        const cursorScan = document.createElement('div');
        cursorScan.classList.add('cursor-scan');
        cursor.appendChild(cursorScan);

        const cursorInner = document.createElement('div');
        cursorInner.classList.add('cursor-inner');
        cursor.appendChild(cursorInner);

        document.body.appendChild(cursor);

        let cursorX = 0;
        let cursorY = 0;
        let cursorRafId = null;
        let cursorTimeout = null;

        // Use requestAnimationFrame for smooth visual updates
        document.addEventListener('mousemove', (e) => {
            cursorX = e.clientX;
            cursorY = e.clientY;

            // Show cursor
            cursor.style.opacity = '1';

            // Reset timeout
            if (cursorTimeout) clearTimeout(cursorTimeout);
            cursorTimeout = setTimeout(() => {
                cursor.style.opacity = '0';
            }, 3000);

            if (!cursorRafId) {
                cursorRafId = requestAnimationFrame(() => {
                    // Use translate3d for GPU acceleration
                    // Only translate the container. The inner element handles centering (-50%, -50%)
                    cursor.style.transform = `translate3d(${cursorX}px, ${cursorY}px, 0)`;
                    cursorRafId = null;
                });
            }
        });

        // Add hover effect to interactive elements
        document.querySelectorAll('a, button, .reveal, h2, h3, tr, p, li, span').forEach(el => {
            el.addEventListener('mouseenter', () => cursor.classList.add('hovered'));
            el.addEventListener('mouseleave', () => cursor.classList.remove('hovered'));
        });

        // 2. Optimized 3D Tilt Effect for Cards
        document.querySelectorAll('.reveal, .modal-card').forEach(card => {
            card.style.transformStyle = 'preserve-3d';
            card.style.perspective = '1000px';
            // Hint browser to promote layer
            card.style.willChange = 'transform';

            let cardRafId = null;
            let bounds = null;

            // Cache bounds on mouse enter to avoid layout thrashing during move
            card.addEventListener('mouseenter', () => {
                bounds = card.getBoundingClientRect();
            });

            card.addEventListener('mousemove', (e) => {
                if (cardRafId) return;

                cardRafId = requestAnimationFrame(() => {
                    // Fallback if bounds missing
                    if (!bounds) bounds = card.getBoundingClientRect();

                    const x = e.clientX - bounds.left;
                    const y = e.clientY - bounds.top;

                    const centerX = bounds.width / 2;
                    const centerY = bounds.height / 2;

                    // Calculate rotation (max 0.5 degrees to be subtle)
                    const rotateX = ((y - centerY) / centerY) * -0.5;
                    const rotateY = ((x - centerX) / centerX) * 0.5;

                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.01)`;

                    cardRafId = null;
                });
            });

            card.addEventListener('mouseleave', () => {
                if (cardRafId) {
                    cancelAnimationFrame(cardRafId);
                    cardRafId = null;
                }
                // Clear inline transform to let CSS take over
                card.style.transform = '';
                bounds = null; // Clear cache
            });
        });

        // 3. Text Scramble Effect
        class TextScramble {
            constructor(el) {
                this.el = el;
                this.chars = '!<>-_\\/[]{}—=+*^?#________';
                this.update = this.update.bind(this);
            }
            setText(newText) {
                const oldText = this.el.innerText;
                const length = Math.max(oldText.length, newText.length);
                const promise = new Promise((resolve) => this.resolve = resolve);
                this.queue = [];
                for (let i = 0; i < length; i++) {
                    const from = oldText[i] || '';
                    const to = newText[i] || '';
                    const start = Math.floor(Math.random() * 60);
                    const end = start + Math.floor(Math.random() * 60);
                    this.queue.push({ from, to, start, end });
                }
                cancelAnimationFrame(this.frameRequest);
                this.frame = 0;
                this.update();
                return promise;
            }
            update() {
                let output = '';
                let complete = 0;
                for (let i = 0, n = this.queue.length; i < n; i++) {
                    let { from, to, start, end, char } = this.queue[i];
                    if (this.frame >= end) {
                        complete++;
                        output += to;
                    } else if (this.frame >= start) {
                        if (!char || Math.random() < 0.02) {
                            char = this.randomChar();
                            this.queue[i].char = char;
                        }
                        output += `<span class="dud">${char}</span>`;
                    } else {
                        output += from;
                    }
                }
                this.el.innerHTML = output;
                if (complete === this.queue.length) {
                    this.resolve();
                } else {
                    this.frameRequest = requestAnimationFrame(this.update);
                    this.frame++;
                }
            }
            randomChar() {
                return this.chars[Math.floor(Math.random() * this.chars.length)];
            }
        }

        // Apply Scramble to H2 titles
        document.querySelectorAll('h2').forEach(el => {
            const fx = new TextScramble(el);
            let originalText = el.innerText;

            // Scramble on hover
            el.addEventListener('mouseenter', () => {
                fx.setText(originalText);
            });
        });

        // 5. Architecture Modals Logic
        const triggers = document.querySelectorAll('.arch-trigger');
        const closeButtons = document.querySelectorAll('.close-btn');
        const modals = document.querySelectorAll('.modal-backdrop');

        triggers.forEach(trigger => {
            trigger.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent bubbling
                const targetId = trigger.getAttribute('data-target');
                const modal = document.getElementById(targetId);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden'; // Prevent scrolling
                }
            });
        });

        closeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const modal = btn.closest('.modal-backdrop');
                modal.classList.remove('active');
                document.body.style.overflow = '';
            });
        });

        // Close on click outside
        modals.forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                modals.forEach(modal => {
                    modal.classList.remove('active');
                });
                document.body.style.overflow = '';
            }
        });

        // 6. Matrix Rain on Sides
        const matrixCanvas = document.createElement('canvas');
        matrixCanvas.id = 'matrix-canvas';
        document.body.appendChild(matrixCanvas);
        const ctx = matrixCanvas.getContext('2d');

        let width = matrixCanvas.width = window.innerWidth;
        let height = matrixCanvas.height = window.innerHeight;
        // Column width 20px
        let cols = Math.floor(width / 20);
        let drops = [];
        let columnState = []; // Track phrase state for each column

        function initDrops() {
            cols = Math.floor(width / 20);
            drops = [];
            columnState = [];
            for (let i = 0; i < cols; i++) {
                // Only active on sides (10% width)
                if (i < cols * 0.1 || i > cols * 0.9) {
                    drops[i] = Math.random() * -100;
                } else {
                    drops[i] = null;
                }
                columnState[i] = null;
            }
        }
        initDrops();

        const chars = "0123456789ABCDEF";
        const phrases = ["西山居SSG中台牛逼", "指导牛逼"];

        let lastDrawTime = 0;
        const frameInterval = 50; // Slow down speed (approx 20fps)

        function drawMatrix(timestamp) {
            if (!timestamp) timestamp = 0;
            if (timestamp - lastDrawTime < frameInterval) {
                requestAnimationFrame(drawMatrix);
                return;
            }
            lastDrawTime = timestamp;

            // Fade effect - slightly darker for better contrast
            ctx.fillStyle = 'rgba(0, 0, 0, 0.08)';
            ctx.fillRect(0, 0, width, height);

            // Base font setting
            ctx.font = '16px "VT323", monospace';

            for (let i = 0; i < drops.length; i++) {
                if (drops[i] === null) continue;

                let text;
                let isSpecial = false;

                // Check if we are in a phrase mode
                if (columnState[i]) {
                    const state = columnState[i];
                    text = state.phrase[state.index];
                    state.index++;
                    if (state.index >= state.phrase.length) {
                        columnState[i] = null; // Phrase finished
                    }
                    isSpecial = true;
                } else {
                    // Random character
                    text = chars[Math.floor(Math.random() * chars.length)];

                    // Small chance to start a phrase
                    if (Math.random() < 0.005) {
                        const p = phrases[Math.floor(Math.random() * phrases.length)];
                        columnState[i] = { phrase: p, index: 0 };
                        text = p[0];
                        columnState[i].index = 1;
                        isSpecial = true;
                    }
                }

                if (isSpecial) {
                    // Highlight style for special phrases
                    ctx.fillStyle = '#FFFFFF'; // Bright white
                    ctx.shadowBlur = 8;
                    ctx.shadowColor = '#00FF00'; // Green glow
                    ctx.font = 'bold 20px "VT323", monospace'; // Larger and bold
                } else {
                    // Retro tech style for normal characters
                    // Varying green opacity for "glitch" feel
                    const opacity = Math.random() > 0.9 ? 1 : 0.7;
                    ctx.fillStyle = `rgba(0, 255, 0, ${opacity})`;
                    ctx.shadowBlur = 0;
                    ctx.font = '16px "VT323", monospace';
                }

                ctx.fillText(text, i * 20, drops[i] * 20);

                // Reset shadow
                ctx.shadowBlur = 0;

                if (drops[i] * 20 > height && Math.random() > 0.975) {
                    drops[i] = 0;
                    columnState[i] = null; // Reset state on loop
                }
                drops[i]++;
            }
            requestAnimationFrame(drawMatrix);
        }

        window.addEventListener('resize', () => {
            width = matrixCanvas.width = window.innerWidth;
            height = matrixCanvas.height = window.innerHeight;
            initDrops();
        });

        requestAnimationFrame(drawMatrix);

        // 7. Interactive Chip Rotation (DISABLED FOR FLAT VIEW)
        /*
        const chipStack = document.getElementById('interactive-chip');
        if (chipStack) {
            let isDragging = false;
            let startX, startY;
            let currentRotX = 60;
            let currentRotZ = 45;
 
            let isClick = true; // Flag to distinguish click from drag
            let isInteractiveTarget = false;
 
            chipStack.addEventListener('mousedown', (e) => {
                // Check if clicking on an interactive block
                if (e.target.closest('.arch-block')) {
                    isInteractiveTarget = true;
                } else {
                    isInteractiveTarget = false;
                }
 
                isDragging = true;
                isClick = true; // Assume click initially
                startX = e.clientX;
                startY = e.clientY;
                chipStack.style.cursor = 'grabbing';
                // Prevent default drag behavior
                e.preventDefault();
            });
 
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
 
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
 
                // If moved significantly, it's a drag, not a click
                if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
                    isClick = false;
                }
 
                // Adjust sensitivity
                currentRotZ += deltaX * 0.5;
                currentRotX -= deltaY * 0.5;
 
                // Only update transform if NOT zoomed (or handle zoom rotation differently)
                if (!chipStack.classList.contains('zoomed')) {
                    chipStack.style.transform = `rotateX(${currentRotX}deg) rotateZ(${currentRotZ}deg)`;
                }
 
                startX = e.clientX;
                startY = e.clientY;
            });
 
            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    chipStack.style.cursor = 'grab';
 
                    if (isClick && !isInteractiveTarget) {
                        // Toggle Zoom only if NOT clicking an interactive block
                        chipStack.classList.toggle('zoomed');
                        if (chipStack.classList.contains('zoomed')) {
                            // Reset rotation visually via CSS !important, but maybe we want to reset internal state?
                            // For now, CSS handles the visual reset.
                        } else {
                            // Restore rotation
                            chipStack.style.transform = `rotateX(${currentRotX}deg) rotateZ(${currentRotZ}deg)`;
                        }
                    }
                }
            });
        }
        */
    </script>
    <!-- Detail Overlay -->
    <div id="detail-overlay">
        <div class="detail-content">
            <div class="detail-header">
                <div class="detail-title" id="detail-title">组件详情</div>
                <div class="zoom-controls">
                    <div class="zoom-btn" onclick="adjustZoom(0.1)">+</div>
                    <div class="zoom-btn" onclick="adjustZoom(-0.1)">-</div>
                </div>
                <button class="detail-close-btn" onclick="closeDetail()" title="关闭视图">
                    <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="3" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="detail-viewport" id="detail-viewport">
                <div class="detail-scene" id="detail-scene">
                    <!-- CPU Detail View -->
                    <div class="detail-view-cpu" id="view-cpu">
                        <h3
                            style="color:var(--accent-cyan); border-bottom:1px solid var(--accent-cyan); margin-bottom: 15px;">
                            CPU 架构</h3>
                        <div class="cpu-core-container">
                            <div class="cpu-core">
                                <div class="core-title">核心 1 (高性能)</div>
                                <div class="cpu-control">控制单元 / 分支预测</div>
                                <div class="cpu-exec-group">
                                    <div class="cpu-unit alu">ALU (整数)</div>
                                    <div class="cpu-unit fpu">FPU (浮点)</div>
                                </div>
                                <div class="cpu-cache-group">
                                    <div class="cpu-cache l1">L1 Cache</div>
                                    <div class="cpu-cache l2">L2 Cache</div>
                                </div>
                            </div>
                            <div class="cpu-core">
                                <div class="core-title">核心 2 (高性能)</div>
                                <div class="cpu-control" style="animation-delay: 0.5s;">控制单元 / 分支预测</div>
                                <div class="cpu-exec-group">
                                    <div class="cpu-unit alu" style="animation-delay: 0.7s;">ALU (整数)</div>
                                    <div class="cpu-unit fpu" style="animation-delay: 0.9s;">FPU (浮点)</div>
                                </div>
                                <div class="cpu-cache-group">
                                    <div class="cpu-cache l1" style="animation-delay: 1.1s;">L1 Cache</div>
                                    <div class="cpu-cache l2" style="animation-delay: 1.3s;">L2 Cache</div>
                                </div>
                            </div>
                        </div>

                        <!-- Bus Connections -->
                        <div class="cpu-bus-container">
                            <div class="bus-line-group" id="bus-group-1">
                                <div class="bus-line"></div>
                                <div class="bus-packet-down"></div>
                                <div class="bus-packet-up"></div>
                            </div>
                            <div class="bus-line-group" id="bus-group-2">
                                <div class="bus-line"></div>
                                <div class="bus-packet-down"></div>
                                <div class="bus-packet-up"></div>
                            </div>
                        </div>

                        <div class="cpu-l3-cache" id="cpu-l3">
                            <div class="l3-label">共享 L3 缓存 / 互连总线</div>
                            <div class="l3-grid"></div>
                        </div>
                    </div>

                    <!-- GPU Detail View -->
                    <div class="detail-view-gpu" id="view-gpu">
                        <h3
                            style="color:var(--accent-red); border-bottom:1px solid var(--accent-red); margin-bottom: 15px;">
                            GPU 架构</h3>
                        <div class="gpu-grid-container">
                            <!-- Generate many cores with random delays -->
                            <script>
                                for (let i = 0; i < 32; i++) {
                                    const delay = Math.random() * 2;
                                    document.write(`<div class="gpu-core-unit" style="animation: gpu-flicker 2s infinite ${delay}s;"></div>`);
                                }
                            </script>
                        </div>
                        <div
                            style="margin-top:15px; text-align:center; color:var(--accent-red); font-weight:bold; text-shadow: 0 0 5px var(--accent-red);">
                            大规模并行处理单元 (32/32 激活)
                        </div>
                    </div>

                    <!-- NPU Detail View -->
                    <div class="detail-view-npu" id="view-npu">
                        <h3
                            style="color:var(--accent-green); border-bottom:1px solid var(--accent-green); margin-bottom: 15px;">
                            NPU 架构</h3>
                        <div class="npu-container">
                            <div class="npu-buffer">权重缓冲</div>
                            <div class="npu-array">
                                <!-- Systolic Array Visual with Wave Animation -->
                                <script>
                                    for (let i = 0; i < 100; i++) {
                                        // Calculate diagonal delay for wave effect
                                        const row = Math.floor(i / 10);
                                        const col = i % 10;
                                        const delay = (row + col) * 0.1;
                                        document.write(`<div class="npu-node" style="animation: npu-pulse 2s infinite ${delay}s;"></div>`);
                                    }
                                </script>
                            </div>
                            <div class="npu-buffer">激活函数</div>
                        </div>
                        <div
                            style="margin-top:15px; text-align:center; color:var(--accent-green); font-weight:bold; text-shadow: 0 0 5px var(--accent-green);">
                            脉动阵列矩阵乘法器
                        </div>
                    </div>
                </div>
            </div>

            <div class="detail-info-panel">
                <div id="detail-desc">选择一个组件以查看详情。</div>
                <div style="margin-top:5px; font-size:0.8rem; color:#888;">操作：滚动缩放 • 拖拽平移</div>
            </div>
        </div>
    </div>

    <script>
        // --- Detail View Logic ---
        const overlay = document.getElementById('detail-overlay');
        const detailTitle = document.getElementById('detail-title');
        const detailDesc = document.getElementById('detail-desc');
        const detailScene = document.getElementById('detail-scene');
        const viewport = document.getElementById('detail-viewport');

        let currentZoom = 1;
        let currentPanX = 0;
        let currentPanY = 0;
        let isPanning = false;
        let lastMouseX = 0;
        let lastMouseY = 0;

        function openDetail(type) {
            // Stop propagation if called from click event
            if (event) event.stopPropagation();

            overlay.classList.add('active');

            // Hide all views first
            document.querySelectorAll('[id^="view-"]').forEach(el => el.style.display = 'none');

            // Reset Transform
            currentZoom = 1;
            currentPanX = 0;
            currentPanY = 0;
            updateTransform();

            if (type === 'cpu') {
                document.getElementById('view-cpu').style.display = 'block';
                detailTitle.innerText = "CPU: 串行处理";
                detailTitle.style.color = "var(--accent-cyan)";
                detailDesc.innerHTML = "<strong>中央处理器 (CPU)</strong> 专为复杂的串行任务设计。它拥有大容量缓存 (L1/L2/L3) 和强大的 ALU/FPU，能够以极低的延迟处理分支预测和多样化的指令集。";

                // Initialize CPU Interactions
                initCpuInteractions();
            } else if (type === 'gpu') {
                document.getElementById('view-gpu').style.display = 'grid'; // Grid for GPU
                detailTitle.innerText = "GPU: 并行处理";
                detailTitle.style.color = "var(--accent-red)";
                detailDesc.innerHTML = "<strong>图形处理器 (GPU)</strong> 由成千上万个小型核心组成，专为大规模并行计算设计。非常适合渲染和可以分解为同时操作 (SIMD) 的任务。";
            } else if (type === 'npu') {
                document.getElementById('view-npu').style.display = 'block';
                detailTitle.innerText = "NPU: 张量处理";
                detailTitle.style.color = "var(--accent-green)";
                detailDesc.innerHTML = "<strong>神经网络处理器 (NPU)</strong> 是针对矩阵乘法优化的专用架构。它采用脉动阵列设计，使数据在处理单元之间流动，从而最大化 AI 推理的吞吐量。";
            }
        }

        function closeDetail() {
            overlay.classList.remove('active');
        }

        function updateTransform() {
            detailScene.style.transform = `translate(-50%, -50%) translate(${currentPanX}px, ${currentPanY}px) scale(${currentZoom})`;
        }

        function adjustZoom(delta) {
            currentZoom += delta;
            if (currentZoom < 0.5) currentZoom = 0.5;
            if (currentZoom > 5) currentZoom = 5;
            updateTransform();
        }

        // Scroll to Zoom
        viewport.addEventListener('wheel', (e) => {
            e.preventDefault();
            const zoomSpeed = 0.001;
            currentZoom += e.deltaY * -zoomSpeed;
            if (currentZoom < 0.5) currentZoom = 0.5;
            if (currentZoom > 5) currentZoom = 5;
            updateTransform();
        });

        // Drag to Pan
        viewport.addEventListener('mousedown', (e) => {
            isPanning = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            viewport.style.cursor = 'grabbing';
        });

        window.addEventListener('mousemove', (e) => {
            if (!isPanning) return;
            const deltaX = e.clientX - lastMouseX;
            const deltaY = e.clientY - lastMouseY;

            // Adjust pan based on zoom level to keep feel consistent
            currentPanX += deltaX / currentZoom;
            currentPanY += deltaY / currentZoom;

            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            updateTransform();
        });

        window.addEventListener('mouseup', () => {
            isPanning = false;
            viewport.style.cursor = 'grab';
        });

        // CPU Interaction Logic
        function initCpuInteractions() {
            const cores = document.querySelectorAll('.cpu-core');
            const l3 = document.getElementById('cpu-l3');
            const busGroups = document.querySelectorAll('.bus-line-group');

            // Core Hover -> Highlight Path to L3
            cores.forEach((core, index) => {
                core.addEventListener('mouseenter', () => {
                    // Highlight this core
                    core.classList.add('active');
                    // Highlight corresponding bus
                    if (busGroups[index]) {
                        busGroups[index].classList.add('active');
                        busGroups[index].classList.add('flow-down'); // Data flows down
                    }
                    // Highlight L3
                    l3.classList.add('active');
                    detailDesc.innerHTML = `<strong>核心 ${index + 1}</strong> 正在访问 <strong>L3 缓存</strong>。数据通过高速互连总线传输。`;
                });

                core.addEventListener('mouseleave', () => {
                    core.classList.remove('active');
                    if (busGroups[index]) {
                        busGroups[index].classList.remove('active');
                        busGroups[index].classList.remove('flow-down');
                    }
                    l3.classList.remove('active');
                    detailDesc.innerHTML = "<strong>中央处理器 (CPU)</strong> 专为复杂的串行任务设计。它拥有大容量缓存 (L1/L2/L3) 和强大的 ALU/FPU，能够以极低的延迟处理分支预测和多样化的指令集。";
                });
            });

            // L3 Hover -> Highlight All Cores
            l3.addEventListener('mouseenter', () => {
                l3.classList.add('active');
                cores.forEach(core => core.classList.add('active'));
                busGroups.forEach(bus => {
                    bus.classList.add('active');
                    bus.classList.add('flow-up'); // Data flows up (broadcast/snoop)
                });
                detailDesc.innerHTML = "<strong>共享 L3 缓存</strong> 协调所有核心之间的数据一致性，并作为通往主内存的高速桥梁。";
            });

            l3.addEventListener('mouseleave', () => {
                l3.classList.remove('active');
                cores.forEach(core => core.classList.remove('active'));
                busGroups.forEach(bus => {
                    bus.classList.remove('active');
                    bus.classList.remove('flow-up');
                });
                detailDesc.innerHTML = "<strong>中央处理器 (CPU)</strong> 专为复杂的串行任务设计。它拥有大容量缓存 (L1/L2/L3) 和强大的 ALU/FPU，能够以极低的延迟处理分支预测和多样化的指令集。";
            });
        }

        // --- Background Music Control ---
        const bgmAudio = document.getElementById('bgm-audio');
        const musicToggle = document.getElementById('music-toggle');
        const musicNext = document.getElementById('music-next');
        const musicIcon = document.getElementById('music-icon');
        const musicText = document.getElementById('music-text');

        // Playlist
        const playlist = [
            "music/Hans Zimmer - Opening Credits_L.ogg",
            "music/Hans Zimmer - Risen from Darkness_L.ogg"
        ];
        let currentTrackIndex = 0;

        // Set initial volume
        bgmAudio.volume = 0.4;

        // Update UI based on actual audio state
        function updateMusicUI() {
            if (!bgmAudio.paused) {
                musicToggle.classList.add('playing');
                musicIcon.innerText = "🔊";
                musicText.innerText = "BGM: ON";
            } else {
                musicToggle.classList.remove('playing');
                musicIcon.innerText = "🔇";
                musicText.innerText = "BGM: OFF";
            }
        }

        // Listen for state changes directly from the audio element
        bgmAudio.addEventListener('play', updateMusicUI);
        bgmAudio.addEventListener('pause', updateMusicUI);

        // Play Next Track
        function playNextTrack() {
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            const nextTrack = playlist[currentTrackIndex];
            console.log("Switching to:", nextTrack);

            bgmAudio.src = nextTrack;
            bgmAudio.play().catch(e => {
                console.error("Play failed for", nextTrack, e);
            });
        }

        // Error handling
        bgmAudio.addEventListener('error', (e) => {
            console.error("Audio Error:", e);
            musicText.innerText = "BGM: ERR";
            // Auto skip to next song on error (e.g. .mgg format issue)
            console.log("Skipping to next track due to error...");
            setTimeout(() => playNextTrack(), 1000);
        });

        // Auto play next when ended
        bgmAudio.addEventListener('ended', () => {
            playNextTrack();
        });

        function toggleMusic(e) {
            // Prevent this click from triggering the document-level fallback
            if (e) e.stopPropagation();

            if (bgmAudio.paused) {
                const playPromise = bgmAudio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(e => {
                        console.error("Play failed:", e);
                        // Don't alert immediately, just log. User might be spamming click.
                    });
                }
            } else {
                bgmAudio.pause();
            }
        }

        // Bind click event
        musicToggle.addEventListener('click', toggleMusic);

        if (musicNext) {
            musicNext.addEventListener('click', (e) => {
                e.stopPropagation();
                playNextTrack();
            });
        }

        // Robust Autoplay Logic
        window.addEventListener('load', () => {
            // 1. Try to play immediately
            const playPromise = bgmAudio.play();

            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("Autoplay prevented. Waiting for interaction.");

                    // 2. Fallback: Play on first interaction
                    const startAudio = () => {
                        bgmAudio.play().then(() => {
                            // Success
                            document.removeEventListener('click', startAudio);
                            document.removeEventListener('keydown', startAudio);
                        }).catch(err => {
                            console.log("Interaction play failed:", err);
                        });
                    };

                    document.addEventListener('click', startAudio);
                    document.addEventListener('keydown', startAudio);
                });
            }
        });

    </script>
</body>

</html>